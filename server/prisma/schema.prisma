generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id          String    @id @default(uuid())
  username    String    @unique
  password    String
  role        String
  name        String?
  isActive    Boolean   @default(true)
  checkIn     DateTime?
  checkOut    DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  idNumber    String?
  idType      String?
  phoneNumber String?
  email       String?
  bookings    Booking[]
  rooms       Room[]
}

model Room {
  id            Int       @id @default(autoincrement())
  number        String    @unique
  type          String
  occupancy     Int
  price         Float
  status        String
  ownerId       String?
  bathroomCount Int       @default(1)
  hasBalcony    Boolean   @default(false)
  isAC          Boolean   @default(false)
  description   String?
  bookings      Booking[]
  owner         User?     @relation(fields: [ownerId], references: [id])
}

model Booking {
  id            String   @id @default(uuid())
  guestId       String
  roomId        Int
  checkIn       DateTime
  checkOut      DateTime
  status        String
  billAmount    Float    @default(0)
  paidAmount    Float    @default(0)
  discount      Float    @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  plainPassword String?
  guest         User     @relation(fields: [guestId], references: [id])
  room          Room     @relation(fields: [roomId], references: [id])
  orders        Order[]
}

model MenuItem {
  id          Int         @id @default(autoincrement())
  name        String
  description String?
  category    String
  price       Float
  isVeg       Boolean
  available   Boolean     @default(true)
  orderItems  OrderItem[]
  hallBookingItems HallBookingItem[]
}

model Order {
  id        String      @id @default(uuid())
  bookingId String
  status    String
  total     Float
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt
  booking   Booking     @relation(fields: [bookingId], references: [id])
  items     OrderItem[]
}

model OrderItem {
  id         String   @id @default(uuid())
  orderId    String
  menuItemId Int
  quantity   Int
  price      Float
  menuItem   MenuItem @relation(fields: [menuItemId], references: [id])
  order      Order    @relation(fields: [orderId], references: [id])
}

model HallGuest {
  id          String        @id @default(uuid())
  name        String
  phoneNumber String
  address     String?
  email       String?
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  bookings    HallBooking[]
}

model HallBooking {
  id            String            @id @default(uuid())
  hallGuestId   String
  eventDate     DateTime
  session       String            // MORNING, EVENING, FULL_DAY
  purpose       String            // Engagement, Birthday, Mundan, etc.
  status        String            // CONFIRMED, COMPLETED, CANCELLED
  guestCount    Int               @default(0)
  notes         Json?   @map("hall_notes_v2")          // Rich Text Notes (JSON)
  
  totalAmount   Float             @default(0)
  advanceAmount Float             @default(0)
  extraAmount   Float             @default(0)
  paidAmount    Float             @default(0)
  
  createdAt     DateTime          @default(now())
  updatedAt     DateTime          @updatedAt
  
  guest         HallGuest         @relation(fields: [hallGuestId], references: [id])
  menuItems     HallBookingItem[]
}

model HallBookingItem {
  id            String      @id @default(uuid())
  hallBookingId String
  menuItemId    Int?
  name          String      @default("")
  price         Float       @default(0)
  quantity      Int         @default(1)
  
  booking       HallBooking @relation(fields: [hallBookingId], references: [id])
  menuItem      MenuItem?   @relation(fields: [menuItemId], references: [id])
}

// RENTAL MANAGEMENT MODULE

model RentalItem {
  id          Int      @id @default(autoincrement())
  name        String
  category    String
  description String?
  price       Float
  totalQty    Int
  available   Boolean @default(true)
  image       String?

  rentalItems RentalOrderItem[]
}

model RentalCustomer {
  id          String   @id @default(uuid())
  name        String
  phoneNumber String
  address     String?
  email       String?
  idProof     String?
  createdAt   DateTime @default(now())
  
  orders      RentalOrder[]
}

model RentalOrder {
  id            String   @id @default(uuid())
  customerId    String
  eventDate     DateTime
  returnDate    DateTime?
  location      String
  status        String    // BOOKED, OUT, RETURNED, CANCELLED

  totalAmount   Float    @default(0)
  advanceAmount Float    @default(0)
  paidAmount    Float    @default(0)
  extraAmount   Float    @default(0)
  securityDeposit Float  @default(0)
  notes           String?

  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  customer      RentalCustomer @relation(fields: [customerId], references: [id])
  items         RentalOrderItem[]
}

model RentalOrderItem {
  id            String   @id @default(uuid())
  rentalOrderId String
  rentalItemId  Int
  quantity      Int
  price         Float   // snapshot: price * quantity

  order         RentalOrder @relation(fields: [rentalOrderId], references: [id])
  item          RentalItem  @relation(fields: [rentalItemId], references: [id])
}